$schema: https://json-schema.org/draft/2020-12/schema

type: array
items:
  type: object
  oneOf:
    - $ref: "#/$defs/mobile-identity" 
    - $ref: "#/$defs/email-identity" 
    - anyOf: 
        - title: 'if-channel-sms'
          allOf:
            - $ref: "#/$defs/mobile-identity"  
            - $ref: "#/$defs/selector/channel-sms"   
                  
        - title: 'if-channel-email'
          allOf:
            - $ref: "#/$defs/email-identity"
            - $ref: "#/$defs/selector/channel-email"


$defs:

  selector:
    channel-email:
      title: 'if-channel-email'
      properties:
        selector:
          type: object
          properties:
            channel:
              type: string
              const: email
        
    channel-sms:
      title: 'if-channel-sms' 
      properties:
        selector:
          type: object
          properties:
            channel:
              type: string
              const: sms  
  email:
    type: object
    x-identifier: email
    properties:
      email:
        $ref: ..\..\..\shared\schemas\StringTemplate.yaml
        
  mobile:
    type: object
    x-identifier: phonenumber  
    properties:
      phonenumber:
        $ref: ..\..\..\shared\schemas\StringTemplate.yaml
        
  mobile-identity:
    type: object
    title:  mobile identity
    properties:
      properties:
        $ref: "#/$defs/mobile" 
      identifier-type:
        type: string
        default: phonenumber
        readOnly: true

      provider:
        type: string
        enum:
          - otp 
  email-identity:
    type: object
    title: email identity 
    properties:
      properties:
        $ref: "#/$defs/email"
     
      identifier-type:
        type: string
        default: email
        readOnly: true

      provider:
        type: string
        enum:
          - otp    
          - lite
          - link
  otp:
    type: object
    x-provider: otp
    properties:
      provider:
        type: string
        const: otp
      
  lite:
    type: object
    x-provider: lite
    properties:
      provider:
        type: string
        const: lite
      

