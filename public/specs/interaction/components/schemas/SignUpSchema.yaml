$schema: "http://json-schema.org/draft-07/hyper-schema#"
title: Sign-Up
type: object
discriminator:
  propertyName: channel
  mapping:
    email: "#/definitions/EmailSchema"
    sms: "#/definitions/SmsSchema"
definitions:
  EmailSchema:
    descreption: when channel is email
    properties:
      identity:
        type: object
        properties:
          email:
            type: string
        required:
          - email
      newsletter:
        type: boolean
        title: Newsletter
      deals:
        type: boolean
        title: Deals
  SmsSchema:
    descreption: when channel is sms
    properties:
      identity:
        type: object
        properties:
          email:
            type: string
        required:
          - email
      newsletter:
        type: boolean
        title: Newsletter
      deals:
        type: boolean
        title: Deals      
  EmailChannel:
    if:
     properties:
        channel:
          type: string
          const: email
    then:
      properties:
        identity:
          type: object
          properties:
            email:
              type: string
          required:
            - email
        newsletter:
          type: boolean
          title: Newsletter
        deals:
          type: boolean
          title: Deals
  SmsChannel:
    type: object
    if:
      properties:
        channel:
          type: string
          enum:
            - sms
    then:
      properties:
        identity:
          type: object
          properties:
            phonrnumber:
              type: string
          required:
            - phonrnumber
        newsletter:
          type: boolean
          title: Newsletter
    
properties:
  channel:
    type: string
    widget: Select
    enum:
      - email
      - sms
    default: email
required:
  - channel
allOf:
  - $ref: "#/definitions/EmailChannel"
  - $ref: "#/definitions/SmsChannel"
oneOf:
  - $ref: "#/definitions/EmailSchema"
  - $ref: "#/definitions/SmsSchema" 
