$schema: "http://json-schema.org/draft-07/hyper-schema#"
title: Sign-Up
type: object
discriminator:
  propertyName: channel
  mapping:
    email: "#/definitions/EmailSchema"
    sms: "#/definitions/SmsSchema"
definitions: 
  EmailChannel: 
    if:
      properties:
        channel:
          type: string
          const: email 
    then:
      properties:
        email:
          type: string
      required:
        - email
        
  
  SmsChannel:
    type: object
    if:
      properties:
        channel:
          type: string
          enum:
            - sms
    then:
      properties:
        phonenumber:
          type: string
      required:
        - phonenumber
        

  Newsletter:
    descreption: newsletter subscribtion list

    allOf:
      - if:
          properties:
            channel:
              type: string
              enum:
                - sms
        then:
          properties:
            newsletter.sms:
              type: boolean
               

      - if:
          properties:
            channel:
              type: string
              enum:
                - email
        then:
          properties:
            newsletter.email:
              type: boolean
      - if:
          properties:
            newsletter.email:
              enum:
                - true                 
        then:
          properties: 
            newsletter.email.weekly:
              type: boolean
  
  Deals:
    descreption: deals subscribtion list, availble only for email channel 
    allOf: 
      - if:
          properties:
            channel:
              type: string
              enum:
                - email
        then:
          properties:
            deals.email:
              type: boolean

  Order-Status:
    descreption: order status subscribtion list, availbale for both email and sms

    allOf:
      - if:
          properties:
            channel:
              type: string
              enum:
                - sms
        then:
          properties:
            order-status.sms:
              type: boolean

      - if:
          properties:
            channel:
              type: string
              enum:
                - email
        then:
          properties:
            order-status.email:
              type: boolean
              
properties:
   
  channel:
    type: string
    widget: Select
    enum:
      - email
      - sms
    default: email
    
#  phonenumber:
#    type: string  
#  
#  email: 
#    type: string
       

required:
  - channel
allOf:
  - $ref: "#/definitions/EmailChannel"
  - $ref: "#/definitions/SmsChannel"
  - $ref: "#/definitions/Newsletter"
  - $ref: "#/definitions/Deals"
  - $ref: "#/definitions/Order-Status"
   